# Обработка изображений на мобильных устройствах

© Бибиков С.А., к.т.н., доцент кафедры суперкомпьютеров и общей информатики, Самарский университет

## Лекция 3. Информационный тракт создания цифровых изображений

Содержание:

### 3.0 Полезные ссылки

Много полезной информации было найдено в [Рендер изображения формата RAW](https://habr.com/ru/post/516228/).

### 3.1 Общее описание простейшего информационного тракта

В процессе создания цифровых изображений решается множество частных задач. Набор методов решения этих задач формируюет информационный тракт получения цифровых изображений. Обработка получаемой информации начинается в момент снятия информации о накопленном заряде с элементов сенсора. Вдаваться в особенности низкоуровневой обработки сигналов, которая происходит в логических схемах мы не будем. Мы сконцентрируемся на более высоком уровне обработки, которую условно можно начать с изображений, за которые можно принять изображения в формате __Camera Raw__ (raw - сырой). Техническая эволюция привела к тому, что многие используемые в тракте алгоритмы (а особенно нейронные сети) решают сразу несколько задач. При этом границы между функциональными этапами стираются. В учебных целях мы будем рассматривать самые стандартные из решаемых задач.

В [статье](https://karaimer.github.io/beyond-rawRGB-sRGB/paper/Karaimer_Brown_CIC19.pdf) приведена неплохая иллюстрация, которую я без зазрения совести использую в рисунке 1.

<div align="center">
  <img src="https://github.com/bbkvsrg/lecture-notes/blob/main/%D0%9E%D0%98%D0%9C%D0%A3/lecture_03/images/l3_1.png" width="99%" title="Цивровой тракт с примером"/>
  
  Рисунок 1 –  Стандартные операции совершаемые при получении цифрового изображения
</div>

Перечислим на русском языке решаемые задачи:
1. Чтение Camera Raw изображения
2. Определение уровней черного
3. Коррекция пространственных аберраций (__это отличная тема для проработки вместо лабораторных__)
4. Дебайеризация
5. Функциональное уменьшение шума
6. Коррекция баланса белого и переход в универсальное цветовое пространство
7. _Нелинейное отображение оттенка и насыщенности (магия)
8. Коррекция экспозиции
9. _Изменения цвета (магия)
10. Тоновая коррекция
11. Переход в целевое линейное цветовое пространство (linear RGB)
12. Гамма преобразование и переход в sRGB

Разберем теперь каждую задачу чуть подробнее.

### 3.2 Получение и чтение RAW изображения

Как мы уже говорили раньше, в сенсорах преобразование интенсивности падающего света преобразуется в электрическийй заряд по линейному принципу, в отличие от естественных зрительных систем, где преобразование связано с химическими реакциями. При этом битность сигнала (количество уровней изменения освещенности) современных сенсоров достаточно высокая, по крайней мере часто больше 8 битов. Для удобства цифровой обработки его обычно принимают за 16 битный сигнал (то есть способный изменяться в пределах от 0 до 65 535). В принципе, сложностей с получением самого сигнала нет никаких. С учетом того, что в большинстве случаев мы не сможем забраться в аппаратную логику сенсора, будем считать что файл в формате Camera Raw (__Важно! .Raw это проприетарный формат Adobe. Не перепутайте__) это то, что получается непосредственно с матрицы. У профессиональных цифровых фотокамер, также как и у многих специальных научных камер и сенсоров, есть возможность сохранять изображения непосредственно в Camera Raw формате. Для эмуляции этого процесса для мобильных устройств можно воспользоваться различными сторонними приложениями для Android (например ON1 Photo RAW for Mobile в Google Play), для телефонов Apple есть встроенный функционал в самой ОС для работы с RAW форматом. Для работы с камерой ноутбука придется повозиться, так как это обычно не предусмотрено создателями драйверов (могут пригодиться программы с открытым кодом [LibRaw](https://www.libraw.org/download)/[dcraw](https://www.dechifro.org/dcraw/index_ru.html)). В любом случае, для проведения опытов и обучения можно скачать нужный файл из сети, но в этом случае придется изучить спецификацию файла.

### 3.3 Определение уровней черного
